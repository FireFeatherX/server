--source include/have_innodb.inc

#
# Test creating table with a key that consists of indirect virtual fields
#

CREATE TABLE t1 (a int, b int as (a+1) virtual, c int as (b+1) virtual, index(c)) engine=myisam;
insert into t1 (a) values (1),(2),(3);
update t1 set a=5 where a=3;
delete from t1 where a=1;
select * from t1;
select * from t1 where c=7;
check table t1;
select * from t1;
drop table t1;

CREATE TABLE t1 (a int, b int as (a+1) virtual, c int as (b+1) virtual, index(c)) engine=innodb;
insert into t1 (a) values (1),(2),(3);
update t1 set a=5 where a=3;
delete from t1 where a=1;
select * from t1;
select * from t1 where c=7;
check table t1;
select * from t1;
drop table t1;
